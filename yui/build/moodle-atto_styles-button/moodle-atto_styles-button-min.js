<<<<<<< HEAD
YUI.add("moodle-atto_styles-button",function(e,t){function r(e,t,n,r){var i,o,u;typeof t=="string"&&t.length&&(i=$("<"+t+"/>").html($(e).html()),$(e).each(function(){$.each(this.attributes,function(){this.specified&&i.attr(this.name,this.value)})}),$(e).replaceWith(i),s(i[0],n,r))}function i(e){var t=[];if(e.nodeType===3)t.push(e);else{var n=e.childNodes,r=n.length;for(var s=0;s<r;++s)t.push(i(n[s]))}return t}function s(e,t,n){if(document.createRange&&window.getSelection){var r=document.createRange(),s=window.getSelection(),o=i(e),u=!1,a=0,f=0,l,c;r.selectNodeContents(e);for(c=0;c<o.length&&n>a;c++)l=o[c],f=a+l.length,!u&&t>=a&&t<=f&&(r.setStart(l,t-a),u=!0),n<=f&&u&&r.setEnd(l,n-a),a=f;n>a&&u&&r.setEnd(l,a),s.removeAllRanges(),s.addRange(r)}else if(document.selection&&document.body.createTextRange){var h=document.body.createTextRange();h.moveToElementText(e),h.collapse(!0),h.moveEnd("character",n),h.moveStart("character",t),h.select()}}var n="atto_styles";e.namespace("M.atto_styles").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(){var t=this.get("styles"),r=[],i,s;t=JSON.parse(t),e.Array.each(t,function(e){i="",s="<span>",e.type==="block"?i='<i class="block_element"></i>':e.type!=="nostyle"&&(i='<i class="inline_element"></i>',s='<span class="inlinestyle">'),r.push({text:s+i+e.title+"</span>",callbackArgs:["<"+e.type+">",e.classes,e.tag]})});var o=this._showToolbarMenu;this._showToolbarMenu=function(e,t){o.call(this,e,t);var n,r,i;n=this.hasRangeSelected(),r=this.menus[t.buttonClass],i=r.get("contentBox"),n?i.removeClass("disableinline"):i.addClass("disableinline")},this.addToolbarMenu({icon:"icon",iconComponent:n,buttonClass:"styles",globalItemConfig:{callback:this._changeStyle},items:r})},_changeStyle:function(e,t){var n,i,s,o;if(t[0]==="<nostyle>"){i=window.getSelection().focusNode;for(s=i;s;s=s.parentNode){if(s.nodeType!==1)continue;o=window.getComputedStyle(s,null);if(o){s.removeAttribute("class"),o.getPropertyValue("display")==="block"?r(s,"div"):r(s,"span");break}}return}if(t[0]==="<block>"){document.execCommand("formatBlock",!1,"<div>"),i=window.getSelection().focusNode;var u=window.getSelection().anchorOffset,a=window.getSelection().focusOffset;for(s=i;s;s=s.parentNode){if(s.nodeType!==1)continue;o=window.getComputedStyle(s,null);if(o){var f=o.getPropertyValue("display");if(f==="block"){n=s;break}}}t[1].length?n.setAttribute("class",t[1]):n.removeAttribute("class"),console.log("replaceTag aufrufen "+t[2]),r(n,t[2],u,a),console.log("fertig")}else{var l=window.getSelection().focusNode,c=window.getSelection().anchorNode,u=window.getSelection().anchorOffset,a=window.getSelection().focusOffset;if(l===c){console.log("case3"),console.log(c.nodeType);var h=l.parentNode;o=window.getComputedStyle(h,null),f=o.getPropertyValue("display");if(f==="block"){var p=$(c).text();if(u===0&&a===p.length)newelement=$("<"+t[2]+' class="'+t[1]+'"/>').html(p),$(h).html(""),$(h).append(newelement);else{var d,v,m;d=p.slice(0,u),v=p.slice(u,a),m=p.slice(a,p.length),newelement=$("<"+t[2]+'class="'+t[1]+'"/>').html(v),$(h).html(d),$(h).append(newelement),$(h).append(m)}}else c.setAttribute("class",t[1]),r(c,t[2],u,a)}}this.markUpdated()},hasRangeSelected:function(){var e,t;return e=rangy.getSelection(),e.rangeCount?(t=e.getRangeAt(0),!t.collapsed):!1}},{ATTRS:{styles:{value:{}}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
=======
YUI.add("moodle-atto_styles-button",function(e,t){var n="atto_styles";e.namespace("M.atto_styles").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(){var t=this.get("styles");t=JSON.parse(t);var r=[],i,s;e.Array.each(t,function(e){i="",s="<span>",e.type==="block"?i='<i class="block_element"></i>':e.type!=="nostyle"&&(i='<i class="inline_element"></i>',s='<span class="inlinestyle">'),r.push({text:s+i+e.title+"</span>",callbackArgs:["<"+e.type+">",e.classes]})});var o=this._showToolbarMenu;this._showToolbarMenu=function(e,t){o.call(this,e,t);var n,r,i;n=this.hasRangeSelected(),r=this.menus[t.buttonClass],i=r.get("contentBox"),n?i.removeClass("disableinline"):i.addClass("disableinline")},this.addToolbarMenu({icon:"icon",iconComponent:n,buttonClass:"styles",globalItemConfig:{callback:this._changeStyle},items:r})},_changeStyle:function(e,t){var n,r,i,s,o,u,a;if(t[0]==="<nostyle>"){r=window.getSelection().focusNode;for(i=r;i;i=i.parentNode){if(i.nodeType!==1)continue;s=window.getComputedStyle(i,null);if(s){i.removeAttribute("class");break}}return}if(t[0]==="<block>"){document.execCommand("formatBlock",!1,"<div>"),r=window.getSelection().focusNode;for(i=r;i;i=i.parentNode){if(i.nodeType!==1)continue;s=window.getComputedStyle(i,null);if(s){var f=s.getPropertyValue("display");if(f==="block"){n=i;break}}}n.setAttribute("class",t[1])}else{o=t[1].split(" "),u=this.get("host");for(a=0;a<o.length;a+=1)u.toggleInlineSelectionClass([o[a]])}this.markUpdated()},hasRangeSelected:function(){var e,t;return e=rangy.getSelection(),e.rangeCount?(t=e.getRangeAt(0),!t.collapsed):!1}},{ATTRS:{styles:{value:{}}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
>>>>>>> refs/remotes/origin/master
